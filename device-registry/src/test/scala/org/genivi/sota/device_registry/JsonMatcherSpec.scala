package org.genivi.sota.device_registry

import io.circe.Json
import io.circe.parser._
import org.scalatest.{FunSuite, Matchers}

class JsonMatcherSpec extends FunSuite with Matchers {

  import JsonMatcher._

  val simpleJsonObj = parse(""" { "key": "value" }                          """).toOption.get
  val keyOnlyObj = parse(""" { "key": null }                             """).toOption.get
  val complexJsonObj = parse(""" { "key": "value", "type": "fish" }          """).toOption.get
  val complexNumericJsonObj = parse(""" { "key": "value", "type": 5 }               """).toOption.get
  val complexJsonArray = parse(""" [ { "key": "value", "type": "fish" } ]      """).toOption.get
  val complexNumericJsonArray = parse(""" [ { "key": "value", "type": 5 } ]           """).toOption.get
  val discardedAttrs1 = parse(""" { "type": null}                             """).toOption.get
  val discardedAttrs2 = parse(""" { "key": null, "type": null}                """).toOption.get
  val discardedAttrs3 = parse(""" { "key": null, "type": null, "fish": null } """).toOption.get
  val discardedAttrs4 = parse(""" { "type": null, "fish": null }              """).toOption.get

  test("json comparison of two empty sets returns empty json object") {
    compare(Json.Null, Json.Null)
      .shouldEqual((Json.Null, Json.Null))
  }

  test("json comparison of two identical json objects returns same object") {
    compare(simpleJsonObj, simpleJsonObj)
      .shouldEqual((simpleJsonObj, Json.Null))
  }

  test("json comparison of two different json objects returns null") {
    compare(simpleJsonObj, keyOnlyObj)
      .shouldEqual((Json.Null, keyOnlyObj))
  }

  test("json comparison of two similar json objects returns common json") {
    compare(simpleJsonObj, complexJsonObj)
      .shouldEqual((simpleJsonObj, Json.obj("type" -> Json.Null)))
  }

  test("json comparison of two json objects with different value types returns common json") {
    compare(complexJsonObj, complexNumericJsonObj)
      .shouldEqual((simpleJsonObj, Json.obj("type" -> Json.Null)))
  }

  test("json comparison of two empty json arrays returns an empty array") {
    compare(Json.arr(), Json.arr())
      .shouldEqual((Json.arr(), Json.Null))
  }

  test("json comparison of two simple json arrays returns common json") {
    compare(Json.arr(simpleJsonObj), Json.arr(simpleJsonObj))
      .shouldEqual((Json.arr(simpleJsonObj), Json.Null))
  }

  test("json comparison of two json arrays with different value types returns common json") {
    compare(complexJsonArray, complexNumericJsonArray)
      .shouldEqual((Json.arr(simpleJsonObj), Json.Null))
  }

  test("disregarding a subset of attributes should yield a subset") {
    disregard(complexJsonObj, discardedAttrs1) shouldBe simpleJsonObj
  }

  test("disregarding all attributes should yield an empty set") {
    disregard(complexJsonObj, discardedAttrs2) shouldBe Json.obj()
  }

  test("disregarding a superset of attributes should yield an empty set") {
    disregard(complexJsonObj, discardedAttrs3) shouldBe Json.obj()
  }

  test("disregarding a disjoint set of attributes should yield a subset") {
    disregard(complexJsonObj, discardedAttrs4) shouldBe simpleJsonObj
  }

  test("json") {
    val json1 = parse("{\"id\":\"computer\",\"id-nr\":\"0\",\"class\":\"system\",\"claimed\":true,\"description\":\"Computer\",\"width\":64,\"capabilities\":{\"smbios-2.5\":\"SMBIOS version 2.5\",\"vsyscall32\":\"32-bit processes\"},\"children\":[{\"id\":\"core\",\"id-nr\":\"1\",\"class\":\"bus\",\"claimed\":true,\"description\":\"Motherboard\",\"physid\":\"0\",\"children\":[{\"id\":\"memory\",\"id-nr\":\"2\",\"class\":\"memory\",\"claimed\":true,\"description\":\"System memory\",\"physid\":\"0\",\"units\":\"bytes\",\"size\":2057728000},{\"id\":\"cpu\",\"id-nr\":\"3\",\"class\":\"processor\",\"claimed\":true,\"product\":\"Intel(R) Core(TM) i7-5650U CPU @ 2.20GHz\",\"vendor\":\"Intel Corp.\",\"physid\":\"1\",\"businfo\":\"cpu@0\",\"width\":64,\"capabilities\":{\"fpu\":\"mathematical co-processor\",\"fpu_exception\":\"FPU exceptions reporting\",\"wp\":true,\"vme\":\"virtual mode extensions\",\"de\":\"debugging extensions\",\"pse\":\"page size extensions\",\"tsc\":\"time stamp counter\",\"msr\":\"model-specific registers\",\"pae\":\"4GB+ memory addressing (Physical Address Extension)\",\"mce\":\"machine check exceptions\",\"cx8\":\"compare and exchange 8-byte\",\"apic\":\"on-chip advanced programmable interrupt controller (APIC)\",\"sep\":\"fast system calls\",\"mtrr\":\"memory type range registers\",\"pge\":\"page global enable\",\"mca\":\"machine check architecture\",\"cmov\":\"conditional move instruction\",\"pat\":\"page attribute table\",\"pse36\":\"36-bit page size extensions\",\"clflush\":true,\"mmx\":\"multimedia extensions (MMX)\",\"fxsr\":\"fast floating point save/restore\",\"sse\":\"streaming SIMD extensions (SSE)\",\"sse2\":\"streaming SIMD extensions (SSE2)\",\"syscall\":\"fast system calls\",\"nx\":\"no-execute bit (NX)\",\"rdtscp\":true,\"x86-64\":\"64bits extensions (x86-64)\",\"constant_tsc\":true,\"rep_good\":true,\"nopl\":true,\"xtopology\":true,\"nonstop_tsc\":true,\"pni\":true,\"pclmulqdq\":true,\"monitor\":true,\"ssse3\":true,\"cx16\":true,\"sse4_1\":true,\"sse4_2\":true,\"movbe\":true,\"popcnt\":true,\"aes\":true,\"xsave\":true,\"avx\":true,\"rdrand\":true,\"hypervisor\":true,\"lahf_lm\":true,\"abm\":true,\"3dnowprefetch\":true,\"rdseed\":true}},{\"id\":\"pci\",\"id-nr\":\"4\",\"class\":\"bridge\",\"claimed\":true,\"handle\":\"PCIBUS:0000:00\",\"description\":\"Host bridge\",\"product\":\"440FX - 82441FX PMC [Natoma]\",\"vendor\":\"Intel Corporation\",\"physid\":\"100\",\"businfo\":\"pci@0000:00:00.0\",\"version\":\"02\",\"width\":32,\"clock\":33000000,\"children\":[{\"id\":\"isa\",\"id-nr\":\"5\",\"class\":\"bridge\",\"claimed\":true,\"handle\":\"PCI:0000:00:01.0\",\"description\":\"ISA bridge\",\"product\":\"82371SB PIIX3 ISA [Natoma/Triton II]\",\"vendor\":\"Intel Corporation\",\"physid\":\"1\",\"businfo\":\"pci@0000:00:01.0\",\"version\":\"00\",\"width\":32,\"clock\":33000000,\"configuration\":{\"latency\":\"0\"},\"capabilities\":{\"isa\":true,\"bus_master\":\"bus mastering\"}},{\"id\":\"ide\",\"id-nr\":\"6\",\"class\":\"storage\",\"claimed\":true,\"handle\":\"PCI:0000:00:01.1\",\"description\":\"IDE interface\",\"product\":\"82371AB/EB/MB PIIX4 IDE\",\"vendor\":\"Intel Corporation\",\"physid\":\"1.1\",\"businfo\":\"pci@0000:00:01.1\",\"version\":\"01\",\"width\":32,\"clock\":33000000,\"configuration\":{\"driver\":\"ata_piix\",\"latency\":\"64\"},\"capabilities\":{\"ide\":true,\"bus_master\":\"bus mastering\"}},{\"id\":\"display\",\"id-nr\":\"7\",\"class\":\"display\",\"handle\":\"PCI:0000:00:02.0\",\"description\":\"VGA compatible controller\",\"product\":\"VirtualBox Graphics Adapter\",\"vendor\":\"InnoTek Systemberatung GmbH\",\"physid\":\"2\",\"businfo\":\"pci@0000:00:02.0\",\"version\":\"00\",\"width\":32,\"clock\":33000000,\"configuration\":{\"latency\":\"0\"},\"capabilities\":{\"vga_controller\":true,\"bus_master\":\"bus mastering\"}},{\"id\":\"network\",\"id-nr\":\"8\",\"class\":\"network\",\"claimed\":true,\"handle\":\"PCI:0000:00:03.0\",\"description\":\"Ethernet interface\",\"product\":\"82540EM Gigabit Ethernet Controller\",\"vendor\":\"Intel Corporation\",\"physid\":\"3\",\"businfo\":\"pci@0000:00:03.0\",\"logicalname\":\"eth0\",\"version\":\"02\",\"serial\":\"[REMOVED]\",\"units\":\"bit/s\",\"size\":1000000000,\"capacity\":1000000000,\"width\":32,\"clock\":66000000,\"configuration\":{\"autonegotiation\":\"on\",\"broadcast\":\"yes\",\"driver\":\"e1000\",\"driverversion\":\"7.3.21-k8-NAPI\",\"duplex\":\"full\",\"ip\":\"[REMOVED]\",\"latency\":\"64\",\"link\":\"yes\",\"mingnt\":\"255\",\"multicast\":\"yes\",\"port\":\"twisted pair\",\"speed\":\"1Gbit/s\"},\"capabilities\":{\"pm\":\"Power Management\",\"pcix\":\"PCI-X\",\"bus_master\":\"bus mastering\",\"cap_list\":\"PCI capabilities listing\",\"ethernet\":true,\"physical\":\"Physical interface\",\"tp\":\"twisted pair\",\"10bt\":\"10Mbit/s\",\"10bt-fd\":\"10Mbit/s (full duplex)\",\"100bt\":\"100Mbit/s\",\"100bt-fd\":\"100Mbit/s (full duplex)\",\"1000bt-fd\":\"1Gbit/s (full duplex)\",\"autonegotiation\":\"Auto-negotiation\"}},{\"id\":\"generic\",\"id-nr\":\"9\",\"class\":\"generic\",\"claimed\":true,\"handle\":\"PCI:0000:00:04.0\",\"description\":\"System peripheral\",\"product\":\"VirtualBox Guest Service\",\"vendor\":\"InnoTek Systemberatung GmbH\",\"physid\":\"4\",\"businfo\":\"pci@0000:00:04.0\",\"version\":\"00\",\"width\":32,\"clock\":33000000,\"configuration\":{\"driver\":\"vboxguest\",\"latency\":\"0\"},\"capabilities\":{\"bus_master\":\"bus mastering\"}},{\"id\":\"bridge\",\"id-nr\":\"10\",\"class\":\"bridge\",\"handle\":\"PCI:0000:00:07.0\",\"description\":\"Bridge\",\"product\":\"82371AB/EB/MB PIIX4 ACPI\",\"vendor\":\"Intel Corporation\",\"physid\":\"7\",\"businfo\":\"pci@0000:00:07.0\",\"version\":\"08\",\"width\":32,\"clock\":33000000,\"configuration\":{\"latency\":\"0\"},\"capabilities\":{\"bridge\":true,\"bus_master\":\"bus mastering\"}}]},{\"id\":\"scsi\",\"id-nr\":\"11\",\"class\":\"storage\",\"claimed\":true,\"physid\":\"2\",\"logicalname\":\"scsi0\",\"capabilities\":{\"emulated\":\"Emulated device\"},\"children\":[{\"id\":\"disk\",\"id-nr\":\"12\",\"class\":\"disk\",\"claimed\":true,\"handle\":\"SCSI:00:00:00:00\",\"description\":\"ATA Disk\",\"product\":\"VBOX HARDDISK\",\"physid\":\"0.0.0\",\"businfo\":\"scsi@0:0.0.0\",\"logicalname\":\"/dev/sda\",\"dev\":\"8:0\",\"version\":\"1.0\",\"serial\":\"[REMOVED]\",\"units\":\"bytes\",\"size\":10632560640,\"configuration\":{\"ansiversion\":\"5\",\"logicalsectorsize\":\"512\",\"sectorsize\":\"512\",\"signature\":\"c1250823\"},\"capabilities\":{\"partitioned\":\"Partitioned disk\",\"partitioned:dos\":\"MS-DOS partition table\"},\"children\":[{\"id\":\"volume:0\",\"id-nr\":\"13\",\"class\":\"volume\",\"claimed\":true,\"description\":\"EXT4 volume\",\"vendor\":\"Linux\",\"physid\":\"1\",\"businfo\":\"scsi@0:0.0.0,1\",\"logicalname\":[\"/dev/sda1\",\"/\"],\"dev\":\"8:1\",\"version\":\"1.0\",\"serial\":\"[REMOVED]\",\"size\":10144972800,\"capacity\":10144972800,\"configuration\":{\"created\":\"2015-10-21 18:04:06\",\"filesystem\":\"ext4\",\"lastmountpoint\":\"/\",\"modified\":\"2016-10-24 09:05:29\",\"mount.fstype\":\"ext4\",\"mount.options\":\"rw,relatime,errors=remount-ro,data=ordered\",\"mounted\":\"2016-09-30 14:57:31\",\"state\":\"mounted\"},\"capabilities\":{\"primary\":\"Primary partition\",\"bootable\":\"Bootable partition (active)\",\"journaled\":true,\"extended_attributes\":\"Extended Attributes\",\"large_files\":\"4GB+ files\",\"huge_files\":\"16TB+ files\",\"dir_nlink\":\"directories with 65000+ subdirs\",\"extents\":\"extent-based allocation\",\"ext4\":true,\"ext2\":\"EXT2/EXT3\",\"initialized\":\"initialized volume\"}},{\"id\":\"volume:1\",\"id-nr\":\"14\",\"class\":\"volume\",\"claimed\":true,\"description\":\"Extended partition\",\"physid\":\"2\",\"businfo\":\"scsi@0:0.0.0,2\",\"logicalname\":\"/dev/sda2\",\"dev\":\"8:2\",\"size\":484443136,\"capacity\":484443136,\"capabilities\":{\"primary\":\"Primary partition\",\"extended\":\"Extended partition\",\"partitioned\":\"Partitioned disk\",\"partitioned:extended\":\"Extended partition\"},\"children\":[{\"id\":\"logicalvolume\",\"id-nr\":\"15\",\"class\":\"volume\",\"claimed\":true,\"description\":\"Linux swap / Solaris partition\",\"physid\":\"5\",\"logicalname\":\"/dev/sda5\",\"dev\":\"8:5\",\"capacity\":484442112,\"capabilities\":{\"nofs\":\"No filesystem\"}}]}]}]}]}]}").toOption.get
    val json2 = parse("{\"id\":\"computer\",\"id-nr\":\"0\",\"class\":\"system\",\"claimed\":true,\"description\":\"Computer\",\"width\":64,\"capabilities\":{\"smbios-2.5\":\"SMBIOS version 2.5\",\"vsyscall32\":\"32-bit processes\"},\"children\":[{\"id\":\"core\",\"id-nr\":\"1\",\"class\":\"bus\",\"claimed\":true,\"description\":\"Motherboard\",\"physid\":\"0\",\"children\":[{\"id\":\"memory\",\"id-nr\":\"2\",\"class\":\"memory\",\"claimed\":true,\"description\":\"System memory\",\"physid\":\"0\",\"units\":\"bytes\",\"size\":2057728000},{\"id\":\"cpu\",\"id-nr\":\"3\",\"class\":\"processor\",\"claimed\":true,\"product\":\"Intel(R) Core(TM) i7-5650U CPU @ 2.20GHz\",\"vendor\":\"Intel Corp.\",\"physid\":\"1\",\"businfo\":\"cpu@0\",\"width\":64,\"capabilities\":{\"fpu\":\"mathematical co-processor\",\"fpu_exception\":\"FPU exceptions reporting\",\"wp\":true,\"vme\":\"virtual mode extensions\",\"de\":\"debugging extensions\",\"pse\":\"page size extensions\",\"tsc\":\"time stamp counter\",\"msr\":\"model-specific registers\",\"pae\":\"4GB+ memory addressing (Physical Address Extension)\",\"mce\":\"machine check exceptions\",\"cx8\":\"compare and exchange 8-byte\",\"apic\":\"on-chip advanced programmable interrupt controller (APIC)\",\"sep\":\"fast system calls\",\"mtrr\":\"memory type range registers\",\"pge\":\"page global enable\",\"mca\":\"machine check architecture\",\"cmov\":\"conditional move instruction\",\"pat\":\"page attribute table\",\"pse36\":\"36-bit page size extensions\",\"clflush\":true,\"mmx\":\"multimedia extensions (MMX)\",\"fxsr\":\"fast floating point save/restore\",\"sse\":\"streaming SIMD extensions (SSE)\",\"sse2\":\"streaming SIMD extensions (SSE2)\",\"syscall\":\"fast system calls\",\"nx\":\"no-execute bit (NX)\",\"rdtscp\":true,\"x86-64\":\"64bits extensions (x86-64)\",\"constant_tsc\":true,\"rep_good\":true,\"nopl\":true,\"xtopology\":true,\"nonstop_tsc\":true,\"pni\":true,\"pclmulqdq\":true,\"monitor\":true,\"ssse3\":true,\"cx16\":true,\"sse4_1\":true,\"sse4_2\":true,\"movbe\":true,\"popcnt\":true,\"aes\":true,\"xsave\":true,\"avx\":true,\"rdrand\":true,\"hypervisor\":true,\"lahf_lm\":true,\"abm\":true,\"3dnowprefetch\":true,\"rdseed\":true}},{\"id\":\"pci\",\"id-nr\":\"4\",\"class\":\"bridge\",\"claimed\":true,\"handle\":\"PCIBUS:0000:00\",\"description\":\"Host bridge\",\"product\":\"440FX - 82441FX PMC [Natoma]\",\"vendor\":\"Intel Corporation\",\"physid\":\"100\",\"businfo\":\"pci@0000:00:00.0\",\"version\":\"02\",\"width\":32,\"clock\":33000000,\"children\":[{\"id\":\"isa\",\"id-nr\":\"5\",\"class\":\"bridge\",\"claimed\":true,\"handle\":\"PCI:0000:00:01.0\",\"description\":\"ISA bridge\",\"product\":\"82371SB PIIX3 ISA [Natoma/Triton II]\",\"vendor\":\"Intel Corporation\",\"physid\":\"1\",\"businfo\":\"pci@0000:00:01.0\",\"version\":\"00\",\"width\":32,\"clock\":33000000,\"configuration\":{\"latency\":\"0\"},\"capabilities\":{\"isa\":true,\"bus_master\":\"bus mastering\"}},{\"id\":\"ide\",\"id-nr\":\"6\",\"class\":\"storage\",\"claimed\":true,\"handle\":\"PCI:0000:00:01.1\",\"description\":\"IDE interface\",\"product\":\"82371AB/EB/MB PIIX4 IDE\",\"vendor\":\"Intel Corporation\",\"physid\":\"1.1\",\"businfo\":\"pci@0000:00:01.1\",\"version\":\"01\",\"width\":32,\"clock\":33000000,\"configuration\":{\"driver\":\"ata_piix\",\"latency\":\"64\"},\"capabilities\":{\"ide\":true,\"bus_master\":\"bus mastering\"}},{\"id\":\"display\",\"id-nr\":\"7\",\"class\":\"display\",\"handle\":\"PCI:0000:00:02.0\",\"description\":\"VGA compatible controller\",\"product\":\"VirtualBox Graphics Adapter\",\"vendor\":\"InnoTek Systemberatung GmbH\",\"physid\":\"2\",\"businfo\":\"pci@0000:00:02.0\",\"version\":\"00\",\"width\":32,\"clock\":33000000,\"configuration\":{\"latency\":\"0\"},\"capabilities\":{\"vga_controller\":true,\"bus_master\":\"bus mastering\"}},{\"id\":\"network\",\"id-nr\":\"8\",\"class\":\"network\",\"claimed\":true,\"handle\":\"PCI:0000:00:03.0\",\"description\":\"Ethernet interface\",\"product\":\"82540EM Gigabit Ethernet Controller\",\"vendor\":\"Intel Corporation\",\"physid\":\"3\",\"businfo\":\"pci@0000:00:03.0\",\"logicalname\":\"eth0\",\"version\":\"02\",\"serial\":\"[REMOVED]\",\"units\":\"bit/s\",\"size\":1000000000,\"capacity\":1000000000,\"width\":32,\"clock\":66000000,\"configuration\":{\"autonegotiation\":\"on\",\"broadcast\":\"yes\",\"driver\":\"e1000\",\"driverversion\":\"7.3.21-k8-NAPI\",\"duplex\":\"full\",\"ip\":\"[REMOVED]\",\"latency\":\"64\",\"link\":\"yes\",\"mingnt\":\"255\",\"multicast\":\"yes\",\"port\":\"twisted pair\",\"speed\":\"1Gbit/s\"},\"capabilities\":{\"pm\":\"Power Management\",\"pcix\":\"PCI-X\",\"bus_master\":\"bus mastering\",\"cap_list\":\"PCI capabilities listing\",\"ethernet\":true,\"physical\":\"Physical interface\",\"tp\":\"twisted pair\",\"10bt\":\"10Mbit/s\",\"10bt-fd\":\"10Mbit/s (full duplex)\",\"100bt\":\"100Mbit/s\",\"100bt-fd\":\"100Mbit/s (full duplex)\",\"1000bt-fd\":\"1Gbit/s (full duplex)\",\"autonegotiation\":\"Auto-negotiation\"}},{\"id\":\"generic\",\"id-nr\":\"9\",\"class\":\"generic\",\"claimed\":true,\"handle\":\"PCI:0000:00:04.0\",\"description\":\"System peripheral\",\"product\":\"VirtualBox Guest Service\",\"vendor\":\"InnoTek Systemberatung GmbH\",\"physid\":\"4\",\"businfo\":\"pci@0000:00:04.0\",\"version\":\"00\",\"width\":32,\"clock\":33000000,\"configuration\":{\"driver\":\"vboxguest\",\"latency\":\"0\"},\"capabilities\":{\"bus_master\":\"bus mastering\"}},{\"id\":\"bridge\",\"id-nr\":\"10\",\"class\":\"bridge\",\"handle\":\"PCI:0000:00:07.0\",\"description\":\"Bridge\",\"product\":\"82371AB/EB/MB PIIX4 ACPI\",\"vendor\":\"Intel Corporation\",\"physid\":\"7\",\"businfo\":\"pci@0000:00:07.0\",\"version\":\"08\",\"width\":32,\"clock\":33000000,\"configuration\":{\"latency\":\"0\"},\"capabilities\":{\"bridge\":true,\"bus_master\":\"bus mastering\"}}]},{\"id\":\"scsi\",\"id-nr\":\"11\",\"class\":\"storage\",\"claimed\":true,\"physid\":\"2\",\"logicalname\":\"scsi0\",\"capabilities\":{\"emulated\":\"Emulated device\"},\"children\":[{\"id\":\"disk\",\"id-nr\":\"12\",\"class\":\"disk\",\"claimed\":true,\"handle\":\"SCSI:00:00:00:00\",\"description\":\"ATA Disk\",\"product\":\"VBOX HARDDISK\",\"physid\":\"0.0.0\",\"businfo\":\"scsi@0:0.0.0\",\"logicalname\":\"/dev/sda\",\"dev\":\"8:0\",\"version\":\"1.0\",\"serial\":\"[REMOVED]\",\"units\":\"bytes\",\"size\":10632560640,\"configuration\":{\"ansiversion\":\"5\",\"logicalsectorsize\":\"512\",\"sectorsize\":\"512\",\"signature\":\"c1250823\"},\"capabilities\":{\"partitioned\":\"Partitioned disk\",\"partitioned:dos\":\"MS-DOS partition table\"},\"children\":[{\"id\":\"volume:0\",\"id-nr\":\"13\",\"class\":\"volume\",\"claimed\":true,\"description\":\"EXT4 volume\",\"vendor\":\"Linux\",\"physid\":\"1\",\"businfo\":\"scsi@0:0.0.0,1\",\"logicalname\":[\"/dev/sda1\",\"/\"],\"dev\":\"8:1\",\"version\":\"1.0\",\"serial\":\"[REMOVED]\",\"size\":10144972800,\"capacity\":10144972800,\"configuration\":{\"created\":\"2015-10-21 18:04:06\",\"filesystem\":\"ext4\",\"lastmountpoint\":\"/\",\"modified\":\"2016-10-25 11:52:53\",\"mount.fstype\":\"ext4\",\"mount.options\":\"rw,relatime,errors=remount-ro,data=ordered\",\"mounted\":\"2016-10-24 09:05:31\",\"state\":\"mounted\"},\"capabilities\":{\"primary\":\"Primary partition\",\"bootable\":\"Bootable partition (active)\",\"journaled\":true,\"extended_attributes\":\"Extended Attributes\",\"large_files\":\"4GB+ files\",\"huge_files\":\"16TB+ files\",\"dir_nlink\":\"directories with 65000+ subdirs\",\"extents\":\"extent-based allocation\",\"ext4\":true,\"ext2\":\"EXT2/EXT3\",\"initialized\":\"initialized volume\"}},{\"id\":\"volume:1\",\"id-nr\":\"14\",\"class\":\"volume\",\"claimed\":true,\"description\":\"Extended partition\",\"physid\":\"2\",\"businfo\":\"scsi@0:0.0.0,2\",\"logicalname\":\"/dev/sda2\",\"dev\":\"8:2\",\"size\":484443136,\"capacity\":484443136,\"capabilities\":{\"primary\":\"Primary partition\",\"extended\":\"Extended partition\",\"partitioned\":\"Partitioned disk\",\"partitioned:extended\":\"Extended partition\"},\"children\":[{\"id\":\"logicalvolume\",\"id-nr\":\"15\",\"class\":\"volume\",\"claimed\":true,\"description\":\"Linux swap / Solaris partition\",\"physid\":\"5\",\"logicalname\":\"/dev/sda5\",\"dev\":\"8:5\",\"capacity\":484442112,\"capabilities\":{\"nofs\":\"No filesystem\"}}]}]}]}]}]}").toOption.get
    val common = JsonMatcher.compare(json1, json2)
    println(common)
    JsonMatcher.compare(json2, common._1) shouldEqual common
    true shouldBe true
  }

}
