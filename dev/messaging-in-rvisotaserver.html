<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <title>GENIVI SOTA Project : Messaging in rvi_sota_server</title>
        <meta name="description" content="Software Updates Over the Air">

        <link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" href="/favicon/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="/favicon/favicon-16x16.png" sizes="16x16">
        <link rel="manifest" href="/favicon/manifest.json">
        <link rel="mask-icon" href="/favicon/safari-pinned-tab.svg">
        <link rel="shortcut icon" href="/favicon/favicon.ico">
        <meta name="msapplication-config" content="/favicon/browserconfig.xml">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css"> 
        <link rel="stylesheet" href="/rvi_sota_server/css/main.css">
        <link rel='stylesheet' href='//cdn.jsdelivr.net/font-hack/2.020/css/hack.min.css'>
    </head>
    <body>
        
      <nav class="top-bar navbar navbar-default navbar-fixed-top text-spacing-md" id="header-navbar">
        <div class="top-bar container-fluid header-wrapper">
          <div class="top-bar navbar-header">
            <button class="navbar-toggle collapsed menu-selector-btn header-collapse-trigger" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-expanded="false" aria-controls="navbar-menu">
              <span class="sr-only">toggle</span>
              <span class="icon-bar top-bar"></span>
              <span class="icon-bar middle-bar"></span>
              <span class="icon-bar bottom-bar"></span>
            </button>
            <a class="top-bar navbar-brand" href="/rvi_sota_server/index.html"><img class="top-bar unfolded-header" src="/rvi_sota_server/images/icon-logo.png" alt="rvi_sota_server"></a>

          </div>
          <ul class="top-bar nav navbar-nav navbar-right visible-md visible-lg visible-sm">
            <li class="top-bar visible-sm visible-md visible-lg">
              <a class="top-bar ats-garage-btn" href="https://advancedtelematic.com/" target="_blank">Developed by ATS
              </a>
            </li>
          </ul>
          <div class="top-bar navbar-collapse collapse header-collapse-nav" id="navbar-menu">
            <div class="top-bar container center-nav-container">
              <div class="btn-container visible-xs">
                <a class="ico-arrow-top-right btn-small text-center uppercase" href="https://app.atsgarage.com/login" target="_blank">Start Now</a>
              </div>
              <div class="btn-container visible-xs">
                <a class="inverted btn-small text-center uppercase" href="https://app.atsgarage.com/login" target="_blank">Login</a>
              </div>
              <ul class="top-bar nav nav-list navbar-nav">
	            
	                <li class="top-bar "><a href="https://github.com/genivi/rvi_sota_server">Server src (stable)</a></li>
	            
	                <li class="top-bar "><a href="https://github.com/advancedtelematic/rvi_sota_server">Server src (dev)</a></li>
	            
	                <li class="top-bar "><a href="https://github.com/genivi/rvi_sota_client">Client src (stable)</a></li>
	            
	                <li class="top-bar "><a href="https://github.com/advancedtelematic/rvi_sota_client">Client src (dev)</a></li>
	            
	                <li class="top-bar docs"><a href="http://advancedtelematic.github.io/rvi_sota_server/">Docs</a></li>
	            

                <li class="visible-xs second-menu separator"></li>
                <li class="second-menu visible-xs clearfix">
                  <ul class="column">
                    <li><a href="http://atsgarage.com/en/privacy-policy.html" target="_blank">Privacy Policy</a></li>
                    <li><a href="http://atsgarage.com/en/terms-conditions.html" target="_blank">Terms of Use</a></li>
                    <li><a href="http://atsgarage.com/en/imprint.html" target="_blank">Imprint</a></li>
                  </ul>
                  <ul class="column">
                    <li><a href="https://github.com/advancedtelematic" target="_blank">Github</a></li>
                    <li><a href="https://twitter.com/ats_news" target="_blank">Twitter</a></li>
                  </ul>
                </li>
                <li class="second-menu small-logo visible-xs">
                  <img src="http://advancedtelematic.com/images/ats_small_logo_white.svg" alt="ATS Advanced Telematic Systems">
                </li>
              </ul>
            </div>
          </div>
        </div>
      </nav>
    

        <div id="main-body">
            <button id="toggle-navigation" class="collapsed">Categories</button>
            <div id="navigation" class="collapsed">
                <ul class="nav nav-tabs nav-justified" data-tabs="tabs">
    
    
    
    
    <li  class="active" ><a data-toggle="tab" href="#genivi">GENIVI SOTA</a></li>
    
</ul>

<div class="tab-content">

    
    
    
    

    <div id="genivi" class="tab-pane fade in  active ">

        <ul class="nav nav-list">
        
            
                
                    
                    
                            
                                <li class="nav-header nav-section-title">Getting Started</li>
                            
                        <li><a class="nav-link " href="/rvi_sota_server/doc/deployment-with-dockercompose.html">Deploying with docker-compose</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/doc/building-installing.html">Building & Deploying from Source</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/doc/admin-gui-user-guide.html">Admin GUI Guide</a></li>
                    
                
            
                
            
                
            
                
            
        
            
                
            
                
                    
                    
                            
                                <li class="nav-header nav-section-title">Developers</li>
                            
                        <li><a class="nav-link " href="/rvi_sota_server/dev/api.html">API</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/dev/contributing.html">Contributing</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/dev/architecture.html">SOTA Architecture</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/dev/application-configuration-options.html">Application configuration options</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/dev/scala-style-guide.html">Scala Style Guide</a></li>
                    
                            
                        <li><a class="nav-link  active " href="/rvi_sota_server/dev/messaging-in-rvisotaserver.html">Messaging in rvi_sota_server</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/dev/database-style-guide.html">Database Style Guide</a></li>
                    
                
            
                
            
                
            
        
            
                
            
                
            
                
                    
                    
                            
                                <li class="nav-header nav-section-title">Client Documentation</li>
                            
                        <li><a class="nav-link " href="/rvi_sota_server/cli/introduction.html">Introduction</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/cli/building-the-sota-client.html">Building the SOTA Client</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/cli/client-startup-and-configuration.html">Client Startup and Configuration</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/cli/client-commands-and-events-reference.html">Client commands and events API reference</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/cli/client-implementation.html">RVI Client Implementation Reference</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/cli/client-implementation-example-session.html">RVI Client Implementation Example Session</a></li>
                    
                
            
                
            
        
            
                
            
                
            
                
            
                
                    
                    
                            
                                <li class="nav-header nav-section-title">Reference</li>
                            
                        <li><a class="nav-link " href="/rvi_sota_server/ref/dependencies.html">Dependencies</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/ref/requirements.html">Requirements</a></li>
                    
                            
                        <li><a class="nav-link " href="/rvi_sota_server/ref/use-cases.html">Use Cases</a></li>
                    
                
            
        
        </ul>

    </div>
    
</div>


            </div>

            <div id="content">
                <div class="page-header">
    <h2>Messaging in rvi_sota_server
        
    </h2>
</div>

<div class="paragraph">
<p>Communication between rvi_sota_server&#8217;s microservices happens over a message bus. Any of the microservices can publish messages to the bus, and other microservices can subscribe to the messages they are interested in. For example, Resolver keeps a database of packages, and thus needs to know when a new package is created. When a package is uploaded via Core&#8217;s PUT /packages endpoint, Core publishes a PackageCreated message, so that Resolver can remain consistent.</p>
</div>
<div class="paragraph">
<p>External services could also consume messages, to extend the system. For example, to produce an audit log, one could create a service that consumes the relevant message types. Messages would also be useful for specialized UIs or monitoring dashboards.</p>
</div>
<div class="paragraph">
<p>The messaging system can use either <a href="https://nats.io/">NATS</a> or <a href="https://kafka.apache.org/">Kafka</a> as a back-end, configurable at runtime. For a NATS backend, set the <code>NATS_HOST</code> and <code>NATS_PORT</code> environment variables; for Kafka, set <code>KAFKA_HOST</code> and <code>KAFKA_PORT</code>. We recommend using Kafka for production deployments. NATS is supported because it is significantly easier to get up and running for testing and development, but unlike Kafka, it has no machanism for guaranteeing that messages have been received, and thus should not be considered safe for production.</p>
</div>
<div class="paragraph">
<p>The messaging logic is stored in <code>common-messaging</code>. Clients of the message bus can be either producers or consumers. A producer may have many consumers, but a consumer may only subscribe to a single producer, and each producer produces only one message type. The current message types are enumerated and described below:</p>
</div>
<div class="sect2">
<h3 id="deviceseen">DeviceSeen</h3>
<div class="paragraph">
<p>This message is sent each time a device connects; for example, when it checks for new updates or sends a report on what software is installed on the device. It also gets sent upon registration.</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The uuid of the device in question</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastSeen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A UTC timestamp of the time the device was seen</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="devicecreated">DeviceCreated</h3>
<div class="paragraph">
<p>This message is sent when a new device is created.</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The uuid of the device in question</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deviceName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The user-friendly name of the device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deviceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Vin of the device or other id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deviceType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the device. Valid device types are <code>Vehicle</code> and <code>Other</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="deviceactivated">DeviceActivated</h3>
<div class="paragraph">
<p>This message is sent the first time a device connects</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The uuid of the device in question</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">at</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A UTC timestamp of the time the device first connected</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="packagecreated">PackageCreated</h3>
<div class="paragraph">
<p>This message is sent when a new package is uploaded
to OTA+</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packageId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An object containing the package name and package version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional string describing the package</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vendor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional string containing the vendor&#8217;s name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">signature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional string containing the digital signature of the package</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="packageblacklisted">PackageBlacklisted</h3>
<div class="paragraph">
<p>This message is sent when a package is blacklisted</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packageId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An object containing the package name and package version</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="imagestorageusage">ImageStorageUsage</h3>
<div class="paragraph">
<p>This message is sent when an OSTree image is pushed.</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A UTC timestamp of when the image was pushed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">byteCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size, in bytes, of the image</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="packagestorageusage">PackageStorageUsage</h3>
<div class="paragraph">
<p>This message is sent when a package is uploaded.</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A UTC timestamp of when the image was pushed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">byteCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size, in bytes, of the package</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="updatespec">UpdateSpec</h3>
<div class="paragraph">
<p>This message is sent when the status of a package update on a particular device changes.</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">device</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The uuid of the device in question</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packageUuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The uuid of the package in question</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string containing the status of the update of the package on the device. Valid values are <code>Pending</code>, <code>InFlight</code>, <code>Canceled</code>, <code>Failed</code> and <code>Finished</code>.</p></td>
</tr>
</tbody>
</table>
</div>

            </div>
        </div>
        <footer class="text-spacing-lg">
    <div class="bright clearfix container-fluid">
        <span class="copyright-links text-spacing-md">
        Doc site built with <a class="menu-link" href="https://asciidoctor.org/">Asciidoctor</a> and <a class="menu-link" href="https://jekyllrb.com/">Jekyll</a>
        </span>
       
        <a class="to-top-small-logo-container" href="#header-navbar">
            <span class="small-logo"></span>
            <span id="to-top"></span>
        </a>
    </div>
</footer>

        
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69301419-1', 'auto');
  ga('send', 'pageview');
</script>

        

        <script src="/rvi_sota_server/js/main.js"></script>
    </body>
</html>
