<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width">

        <title>GENIVI SOTA Project : Messaging in rvi_sota_server</title>
        <meta name="description" content="Software Updates Over the Air">

        <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
        <link rel="stylesheet" href="/rvi_sota_server/css/main.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">
    </head>
    <body>

        <div class="container-fluid">
            <div class="row">
                <div id="header" class="col-sm-12">
                    <h4><img src="/rvi_sota_server/images/icon-logo.png"> <a class="brand" href="/rvi_sota_server/">GENIVI SOTA Project</a> / 
    Software Updates Over the Air
</h4>

                </div>
            </div>

            <div class="row">
                
                
                    <div id="navigation" class="col-sm-3">
                        <ul class="nav nav-list">
    <li><a href="/rvi_sota_server/">Home</a></li>
    
        
        

        
            
                <li class="nav-header">Getting Started</li>
            
            <li data-order="2"><a href="/rvi_sota_server/doc/deployment-with-dockercompose.html">Deployment with docker-compose</a></li>
        
            
            <li data-order="3"><a href="/rvi_sota_server/doc/admin-gui-user-guide.html">Admin GUI Guide</a></li>
        
            
            <li data-order="1"><a href="/rvi_sota_server/doc/building-installing.html">Building & Deploying</a></li>
        
    
        
        

        
            
                <li class="nav-header">Developers</li>
            
            <li data-order="6"><a href="/rvi_sota_server/dev/messaging-in-rvisotaserver.html">Messaging in rvi_sota_server</a></li>
        
            
            <li data-order="10"><a href="/rvi_sota_server/dev/generated-documentation.html">Auto-generated Documentation</a></li>
        
            
            <li data-order="4"><a href="/rvi_sota_server/dev/architecture.html">SOTA Architecture</a></li>
        
            
            <li data-order="1"><a href="/rvi_sota_server/dev/contributing.html">Contributing</a></li>
        
            
            <li data-order="6"><a href="/rvi_sota_server/dev/database-style-guide.html">Database Style Guide</a></li>
        
            
            <li data-order="5"><a href="/rvi_sota_server/dev/scala-style-guide.html">Scala Style Guide</a></li>
        
            
            <li data-order="1"><a href="/rvi_sota_server/dev/api.html">API</a></li>
        
    
        
        

        
            
                <li class="nav-header">Client Documentation</li>
            
            <li data-order="2"><a href="/rvi_sota_server/cli/building-the-sota-client.html">Building the SOTA Client</a></li>
        
            
            <li data-order="3"><a href="/rvi_sota_server/cli/client-commands-and-events-reference.html">Client commands and events API reference</a></li>
        
            
            <li data-order="1"><a href="/rvi_sota_server/cli/introduction.html">Introduction</a></li>
        
            
            <li data-order="2"><a href="/rvi_sota_server/cli/client-startup-and-configuration.html">Client Startup and Configuration</a></li>
        
            
            <li data-order="8"><a href="/rvi_sota_server/cli/client-implementation-example-session.html">RVI Client Implementation Example Session</a></li>
        
            
            <li data-order="7"><a href="/rvi_sota_server/cli/client-implementation.html">RVI Client Implementation Reference</a></li>
        
    
        
        

        
            
                <li class="nav-header">Security Approach</li>
            
            <li data-order=""><a href="/rvi_sota_server/sec/security-threats-mitigations.html">Security Threats & Mitigations</a></li>
        
            
            <li data-order=""><a href="/rvi_sota_server/sec/whitelisted-interactions.html">Whitelisted Interactions</a></li>
        
    
        
        

        
            
                <li class="nav-header">Reference</li>
            
            <li data-order=""><a href="/rvi_sota_server/ref/dependencies.html">Dependencies</a></li>
        
            
            <li data-order="5"><a href="/rvi_sota_server/ref/use-cases.html">Use Cases</a></li>
        
            
            <li data-order="4"><a href="/rvi_sota_server/ref/requirements.html">Requirements</a></li>
        
    
<!-- List additional links. It is recommended to add a divider
    e.g. <li class="divider"></li> first to break up the content. -->
</ul>

                    </div>

                    <div id="content" class="col-sm-9">
                        <div id="content" class="col-sm-10">
                            <div class="page-header">
    <h2>Messaging in rvi_sota_server
        
    </h2>
</div>

<div class="paragraph">
<p>Communication between rvi_sota_server&#8217;s microservices happens over a message bus. Any of the microservices can publish messages to the bus, and other microservices can subscribe to the messages they are interested in. For example, Resolver keeps a database of packages, and thus needs to know when a new package is created. When a package is uploaded via Core&#8217;s PUT /packages endpoint, Core publishes a PackageCreated message, so that Resolver can remain consistent.</p>
</div>
<div class="paragraph">
<p>External services could also consume messages, to extend the system. For example, to produce an audit log, one could create a service that consumes the relevant message types. Messages would also be useful for specialized UIs or monitoring dashboards.</p>
</div>
<div class="paragraph">
<p>The messaging system can use either <a href="https://nats.io/">NATS</a> or <a href="https://kafka.apache.org/">Kafka</a> as a back-end, configurable at runtime. For a NATS backend, set the <code>NATS_HOST</code> and <code>NATS_PORT</code> environment variables; for Kafka, set <code>KAFKA_HOST</code> and <code>KAFKA_PORT</code>. We recommend using Kafka for production deployments. NATS is supported because it is significantly easier to get up and running for testing and development, but unlike Kafka, it has no machanism for guaranteeing that messages have been received, and thus should not be considered safe for production.</p>
</div>
<div class="paragraph">
<p>The messaging logic is stored in <code>common-messaging</code>. Clients of the message bus can be either producers or consumers. A producer may have many consumers, but a consumer may only subscribe to a single producer, and each producer produces only one message type. The current message types are enumerated and described below:</p>
</div>
<div class="sect2">
<h3 id="deviceseen">DeviceSeen</h3>
<div class="paragraph">
<p>This message is sent each time a device connects; for example, when it checks for new updates or sends a report on what software is installed on the device. It also gets sent upon registration.</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 60%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The uuid of the device in question</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">lastSeen</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A UTC timestamp of the time the device was seen</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="devicecreated">DeviceCreated</h3>
<div class="paragraph">
<p>This message is sent when a new device is created.</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 60%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The uuid of the device in question</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deviceName</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The user-friendly name of the device</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deviceId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Vin of the device or other id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deviceType</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Type of the device. Valid device types are <code>Vehicle</code> and <code>Other</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="deviceactivated">DeviceActivated</h3>
<div class="paragraph">
<p>This message is sent the first time a device connects</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 60%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">uuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The uuid of the device in question</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">at</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A UTC timestamp of the time the device first connected</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="packagecreated">PackageCreated</h3>
<div class="paragraph">
<p>This message is sent when a new package is uploaded
to OTA+</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 60%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packageId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An object containing the package name and package version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional string describing the package</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">vendor</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional string containing the vendor&#8217;s name</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">signature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An optional string containing the digital signature of the package</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="packageblacklisted">PackageBlacklisted</h3>
<div class="paragraph">
<p>This message is sent when a package is blacklisted</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 60%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packageId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">An object containing the package name and package version</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="imagestorageusage">ImageStorageUsage</h3>
<div class="paragraph">
<p>This message is sent when an OSTree image is pushed.</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 60%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A UTC timestamp of when the image was pushed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">byteCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size, in bytes, of the image</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="packagestorageusage">PackageStorageUsage</h3>
<div class="paragraph">
<p>This message is sent when a package is uploaded.</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 60%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">timestamp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A UTC timestamp of when the image was pushed</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">byteCount</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The size, in bytes, of the package</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="updatespec">UpdateSpec</h3>
<div class="paragraph">
<p>This message is sent when the status of a package update on a particular device changes.</p>
</div>
<div class="paragraph">
<p>Fields:</p>
</div>
<table class="tableblock frame-all grid-all" style="width: 60%;">
<colgroup>
<col style="width: 20%;">
<col style="width: 80%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">namespace</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string representing the namespace subscribed to</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">device</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The uuid of the device in question</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">packageUuid</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The uuid of the package in question</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">status</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A string containing the status of the update of the package on the device. Valid values are <code>Pending</code>, <code>InFlight</code>, <code>Canceled</code>, <code>Failed</code> and <code>Finished</code>.</p></td>
</tr>
</tbody>
</table>
</div>

                        </div>
                    </div>
                
            </div>

            

            <div class="row">
                <div id="footer" class="col-sm-12">
                    Documentation for <a href="https://github.com/genivi/rvi_sota_server">GENIVI SOTA Project</a>

                </div>
            </div>
        </div>

        <script>
            function orderNav() {
                var list,
                    section,
                    header,
                    sections = [],
                    lists = {},
                    headers = {};

                var navUl = document.querySelectorAll('#navigation ul')[0],
                    navLis = document.querySelectorAll('#navigation ul li');

                if (!navUl) return;

                for (var i = 0; i < navLis.length; i++) {
                    var order, li = navLis[i];

                    if (li.classList.contains('nav-header')) {
                        section = li.textContent || li.innerText;
                        sections.push(section);
                        headers[section] = li;
                        continue;
                    }

                    if (!lists[section]) {
                        lists[section] = [];
                    }

                    order = parseFloat(li.getAttribute('data-order'))
                    lists[section].push([order, li]);
                }

                for (var i = 0; i < sections.length; i++) {
                    section = sections[i];
                    list = lists[section].sort(function(a, b) {
                        return a[0] - b[0];
                    });

                    if (header = headers[section]) {
                        navUl.appendChild(header);
                    }
                    for (var j = 0; j < list.length; j++) {
                        navUl.appendChild(list[j][1]);
                    }
                }
            }

            if (document.querySelectorAll) orderNav();
        </script>
        
        <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-69301419-1', 'auto');
  ga('send', 'pageview');
</script>

        
    </body>
</html>
